<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.meng.store.model.mapper.StoreMapper">
    <!-- 配置 数据库列和实体类的属性的对应关系 https://mybatis.org/mybatis-3/zh/sqlmap-xml.html -->
    <resultMap id="storeMap" type="com.meng.store.model.dto.StoreListDto">
        <!--主键字段的对应 -->
        <id property="id" javaType="Integer" column="id"/>
        <!-- 非主键字段的对应-->
        <result property="code" javaType="String" column="code"/>
        <result property="icon" javaType="String" column="icon"/>
        <result property="name" javaType="String" column="app_name"/>
        <result property="version" javaType="String" column="versions"/>
        <result property="desc" javaType="String" column="desc"/>
        <result property="url" javaType="String" column="url"/>
        <result property="tag" javaType="String" column="tag"/>
        <result property="env" javaType="String" column="env"/>
        <result property="createTime" javaType="String" column="create_time"/>
        <result property="modifyTime" javaType="String" column="modify_time"/>
    </resultMap>

    <resultMap id="storeDetail" type="com.meng.store.model.dto.StoreDetailDto">
        <!--主键字段的对应 -->
        <id property="id" javaType="Integer" column="id"/>
        <!-- 非主键字段的对应-->
        <result property="uid" javaType="Integer" column="uid"/>
        <result property="code" javaType="String" column="code"/>
        <result property="icon" javaType="String" column="icon"/>
        <result property="name" javaType="String" column="app_name"/>
        <result property="version" javaType="String" column="versions"/>
        <result property="desc" javaType="String" column="desc"/>
<!--        <result property="url" javaType="String" column="url"/>-->
        <result property="memo" javaType="String" column="memo"/>
        <result property="tag" javaType="String" column="tag"/>
<!--        <result property="env" javaType="String" column="env"/>-->
        <result property="createTime" javaType="String" column="create_time"/>
        <result property="modifyTime" javaType="String" column="modify_time"/>
    </resultMap>

    <select id="queryList" resultMap="storeMap">
        SELECT * FROM apps
    </select>

    <!--    <select id="queryList" resultMap="com.meng.store.model.entity.StoreEntity">-->
    <!--        SELECT * FROM apps-->
    <!--    </select>-->

    <!--    <insert id="createApp" useGeneratedKeys="true" keyProperty="id">-->
    <insert id="createApp">
        insert into apps (uid,code,app_name,url,versions,intro,tag,create_time,modify_time)
        values (#{uid},#{code},#{name},#{url},#{version},#{intro},#{tag},#{date},#{date})

        <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>

    <select id="getDetailById" resultMap="storeDetail">
        SELECT * FROM apps where id=#{id}
    </select>

    <select id="getDetailByCode" resultMap="storeDetail">
        SELECT * FROM apps where code=#{code}
    </select>

    <select id="queryApp" resultType="int">
        <!--        SELECT count(*) FROM apps where code = #{code}-->
        SELECT id FROM apps where code = #{code}
    </select>

    <update id="updateApp" parameterType="com.meng.store.model.body.AppBody">
        update apps
        <trim prefix="set" suffixOverrides=",">
            <if test="name != null and name != ''">app_name= #{name},</if>
            <if test="icon != null and icon != ''">icon= #{icon},</if>
            <if test="intro != null and intro != ''">intro= #{intro},</if>
<!--            <if test="url != null and url != ''">url=#{url},</if>-->
            <if test="version != null and version != ''">versions= #{version},</if>
            <if test="modifyTime != null and modifyTime != ''">modify_time= #{modifyTime},</if>
        </trim>
        where id= #{id}
    </update>

    <delete id="deleteApp">
        DELETE FROM apps where id = #{id}
    </delete>

    <select id="appNumber" resultType="int">
        SELECT count(*) FROM apps
    </select>
</mapper>